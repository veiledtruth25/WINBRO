<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index of Files</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .breadcrumb {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .breadcrumb a {
            color: white;
            text-decoration: none;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        
        .breadcrumb a:hover {
            border-bottom-color: white;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .file-list {
            list-style: none;
        }
        
        .file-item {
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        
        .file-item:hover {
            background: #f9f9f9;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-link {
            display: flex;
            align-items: center;
            padding: 16px 30px;
            text-decoration: none;
            color: #333;
            gap: 12px;
        }
        
        .file-icon {
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .file-info {
            flex: 1;
            min-width: 0;
        }
        
        .file-name {
            font-size: 15px;
            font-weight: 500;
            color: #0366d6;
            word-break: break-word;
        }
        
        .file-size {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }
        
        .error {
            padding: 40px 30px;
            text-align: center;
            color: #d73a49;
        }
        
        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .empty {
            padding: 60px 30px;
            text-align: center;
            color: #666;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 0;
            }
            
            .container {
                border-radius: 0;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .file-link {
                padding: 14px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="title">Loading...</h1>
            <div class="breadcrumb" id="breadcrumb"></div>
        </header>
        
        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Memuat file...</p>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // KONFIGURASI - EDIT BAGIAN INI
        // ========================================
        
        const CONFIG = {
            owner: 'veiledtruth25',    // Ganti dengan GitHub username kamu
            repo: 'WINBRO',            // Ganti dengan nama repository
            
            // Daftar folder yang boleh di-listing (kosongkan array untuk list semua)
            allowedFolders: ['public', 'downloads', 'docs'],
            
            // Path default yang akan ditampilkan (kosongkan untuk root)
            defaultPath: '',
            
            // Tampilkan ukuran file?
            showFileSize: true,
            
            // Sembunyikan file di root? (hanya tampilkan folder)
            hideRootFiles: true
        };
        
        // ========================================
        // FUNGSI UTAMA - JANGAN EDIT KALAU GAK PERLU
        // ========================================
        
        function getIcon(type, name) {
            if (type === 'dir') return 'üìÅ';
            
            const ext = name.split('.').pop().toLowerCase();
            const icons = {
                pdf: 'üìÑ', doc: 'üìÑ', docx: 'üìÑ', txt: 'üìÑ',
                zip: 'üì¶', rar: 'üì¶', '7z': 'üì¶', tar: 'üì¶', gz: 'üì¶',
                jpg: 'üñºÔ∏è', jpeg: 'üñºÔ∏è', png: 'üñºÔ∏è', gif: 'üñºÔ∏è', svg: 'üñºÔ∏è',
                mp4: 'üé¨', avi: 'üé¨', mov: 'üé¨', mkv: 'üé¨',
                mp3: 'üéµ', wav: 'üéµ', flac: 'üéµ',
                html: 'üåê', css: 'üé®', js: '‚ö°', json: 'üìã',
                py: 'üêç', java: '‚òï', cpp: '‚öôÔ∏è', c: '‚öôÔ∏è',
                md: 'üìù', exe: '‚öôÔ∏è', apk: 'üì±'
            };
            
            return icons[ext] || 'üìÑ';
        }
        
        function formatSize(bytes) {
            if (!bytes || !CONFIG.showFileSize) return '';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }
        
        function isAllowedFolder(folderName, currentPath) {
            // Jika allowedFolders kosong, semua folder diperbolehkan
            if (CONFIG.allowedFolders.length === 0) return true;
            
            // Jika di root, cek apakah folder ada di allowedFolders
            if (!currentPath) {
                return CONFIG.allowedFolders.includes(folderName);
            }
            
            // Jika sudah di dalam folder yang diperbolehkan, semua subfolder diperbolehkan
            const rootFolder = currentPath.split('/')[0];
            return CONFIG.allowedFolders.includes(rootFolder);
        }
        
        async function listFiles(path = CONFIG.defaultPath) {
            const content = document.getElementById('content');
            const title = document.getElementById('title');
            const breadcrumb = document.getElementById('breadcrumb');
            
            // Update title dan breadcrumb
            const displayPath = path || '/';
            title.textContent = `Index of /${path}`;
            
            // Buat breadcrumb
            const parts = path ? path.split('/') : [];
            let breadcrumbHTML = '<a href="?">Home</a>';
            let currentPath = '';
            
            parts.forEach((part, index) => {
                currentPath += (index > 0 ? '/' : '') + part;
                breadcrumbHTML += ` / <a href="?path=${encodeURIComponent(currentPath)}">${part}</a>`;
            });
            
            breadcrumb.innerHTML = breadcrumbHTML;
            
            try {
                const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                let files = await response.json();
                
                // Filter folder yang tidak diperbolehkan (hanya di root level)
                if (!path && CONFIG.allowedFolders.length > 0) {
                    files = files.filter(file => {
                        if (file.type === 'dir') {
                            return isAllowedFolder(file.name, path);
                        }
                        return true; // File selalu ditampilkan
                    });
                }
                
                // Sembunyikan file di root jika hideRootFiles = true
                if (!path && CONFIG.hideRootFiles) {
                    files = files.filter(file => file.type === 'dir');
                }
                
                // Sort: folder dulu, lalu file, alphabetically
                files.sort((a, b) => {
                    if (a.type === b.type) {
                        return a.name.localeCompare(b.name);
                    }
                    return a.type === 'dir' ? -1 : 1;
                });
                
                if (files.length === 0) {
                    content.innerHTML = `
                        <div class="empty">
                            <div class="empty-icon">üìÇ</div>
                            <p>Folder ini kosong</p>
                        </div>
                    `;
                    return;
                }
                
                // Render file list
                const ul = document.createElement('ul');
                ul.className = 'file-list';
                
                // Tambah parent directory jika bukan di root
                if (path) {
                    const parentPath = path.split('/').slice(0, -1).join('/');
                    const li = document.createElement('li');
                    li.className = 'file-item';
                    li.innerHTML = `
                        <a href="?path=${encodeURIComponent(parentPath)}" class="file-link">
                            <span class="file-icon">‚¨ÜÔ∏è</span>
                            <div class="file-info">
                                <div class="file-name">..</div>
                            </div>
                        </a>
                    `;
                    ul.appendChild(li);
                }
                
                files.forEach(file => {
                    const li = document.createElement('li');
                    li.className = 'file-item';
                    
                    const icon = getIcon(file.type, file.name);
                    const isDir = file.type === 'dir';
                    
                    // Untuk file: gunakan download_url, untuk folder: navigasi
                    const href = isDir 
                        ? `?path=${encodeURIComponent(file.path)}`
                        : file.download_url;
                    
                    // Tambahkan download attribute untuk file
                    const downloadAttr = isDir ? '' : `download="${file.name}"`;
                    
                    const sizeInfo = !isDir && file.size 
                        ? `<div class="file-size">${formatSize(file.size)}</div>`
                        : '';
                    
                    li.innerHTML = `
                        <a href="${href}" class="file-link" ${downloadAttr}>
                            <span class="file-icon">${icon}</span>
                            <div class="file-info">
                                <div class="file-name">${file.name}</div>
                                ${sizeInfo}
                            </div>
                        </a>
                    `;
                    
                    ul.appendChild(li);
                });
                
                content.innerHTML = '';
                content.appendChild(ul);
                
            } catch (error) {
                content.innerHTML = `
                    <div class="error">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p style="margin-top: 10px; font-size: 14px;">
                            Pastikan konfigurasi owner dan repo sudah benar.
                        </p>
                    </div>
                `;
            }
        }
        
        // Get path dari URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const path = urlParams.get('path') || CONFIG.defaultPath;
        
        // Load files
        listFiles(path);
    </script>
</body>
</html>
